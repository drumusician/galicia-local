<!DOCTYPE html>
<html lang="en">
  <head>
    {Application.get_env(:live_debugger, :live_debugger_tags)}

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />
    <.live_title default="GaliciaLocal" suffix=" ¬∑ Phoenix Framework">
      {assigns[:page_title]}
    </.live_title>
    <link phx-track-static rel="stylesheet" href={~p"/assets/css/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/app.js"}>
    </script>
    <script>
      (() => {
        const setTheme = (theme) => {
          if (theme === "system") {
            localStorage.removeItem("phx:theme");
            document.documentElement.removeAttribute("data-theme");
          } else {
            localStorage.setItem("phx:theme", theme);
            document.documentElement.setAttribute("data-theme", theme);
          }
        };
        if (!document.documentElement.hasAttribute("data-theme")) {
          setTheme(localStorage.getItem("phx:theme") || "system");
        }
        window.addEventListener("storage", (e) => e.key === "phx:theme" && setTheme(e.newValue || "system"));
        
        window.addEventListener("phx:set-theme", (e) => setTheme(e.target.dataset.phxTheme));
      })();
    </script>
  </head>
  <body>
    <nav class="bg-base-100/95 backdrop-blur-md shadow-sm border-b border-base-200 sticky top-0 z-40">
      <div class="container mx-auto max-w-6xl px-4 flex items-center h-14">
        <!-- Brand -->
        <div class="flex-1">
          <a href="/" class="flex items-center gap-2 text-primary hover:opacity-80 transition-opacity">
            <span class="text-2xl">üêö</span>
            <span class="text-xl font-bold tracking-tight">GaliciaLocal</span>
          </a>
        </div>

        <!-- Desktop nav -->
        <div class="hidden md:flex items-center gap-1">
          <a href="/search" class="btn btn-ghost btn-sm gap-1">
            <span class="hero-magnifying-glass w-4 h-4"></span>
            Search
          </a>
          <a href="/cities" class="btn btn-ghost btn-sm gap-1">
            <span class="hero-map w-4 h-4"></span>
            Cities
          </a>
          <a href="/categories" class="btn btn-ghost btn-sm gap-1">
            <span class="hero-squares-2x2 w-4 h-4"></span>
            Categories
          </a>
          <div class="divider divider-horizontal mx-1 h-6"></div>
          <%= if assigns[:current_user] do %>
            <div class="dropdown dropdown-end">
              <div tabindex="0" role="button" class="btn btn-ghost btn-sm gap-2">
                <div class="avatar placeholder">
                  <div class="bg-primary text-primary-content rounded-full w-7 h-7">
                    <span class="text-xs">
                      <%= String.first(assigns[:current_user].display_name || assigns[:current_user].email |> to_string()) %>
                    </span>
                  </div>
                </div>
                <span class="hero-chevron-down w-3 h-3"></span>
              </div>
              <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-50 w-52 p-2 shadow-lg border border-base-200 mt-2">
                <li class="menu-title text-xs opacity-60 px-2 pt-1">
                  <%= assigns[:current_user].display_name || assigns[:current_user].email %>
                </li>
                <li><a href="/profile"><span class="hero-user-circle w-4 h-4"></span> My Profile</a></li>
                <li></li>
                <li><a href="/sign-out" class="text-base-content/60"><span class="hero-arrow-right-start-on-rectangle w-4 h-4"></span> Sign Out</a></li>
              </ul>
            </div>
          <% else %>
            <a href="/sign-in" class="btn btn-primary btn-sm">Join Community</a>
          <% end %>
        </div>

        <!-- Mobile hamburger -->
        <div class="md:hidden">
          <div class="dropdown dropdown-end">
            <div tabindex="0" role="button" class="btn btn-ghost btn-sm">
              <span class="hero-bars-3 w-5 h-5"></span>
            </div>
            <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-50 w-56 p-2 shadow-lg border border-base-200 mt-2">
              <li><a href="/search"><span class="hero-magnifying-glass w-4 h-4"></span> Search</a></li>
              <li><a href="/cities"><span class="hero-map w-4 h-4"></span> Cities</a></li>
              <li><a href="/categories"><span class="hero-squares-2x2 w-4 h-4"></span> Categories</a></li>
              <li></li>
              <%= if assigns[:current_user] do %>
                <li><a href="/profile"><span class="hero-user-circle w-4 h-4"></span> My Profile</a></li>
                <li><a href="/sign-out"><span class="hero-arrow-right-start-on-rectangle w-4 h-4"></span> Sign Out</a></li>
              <% else %>
                <li><a href="/sign-in" class="text-primary font-semibold"><span class="hero-arrow-right-end-on-rectangle w-4 h-4"></span> Join Community</a></li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </nav>
    {@inner_content}
  </body>
</html>
